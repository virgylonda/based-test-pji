<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pji.cbt.mapper.TestUserMapper">
	<resultMap type="pji.cbt.entities.User" id="resultUser">
		<id property="userId" column="id"/>
		<result property="username" column="username"/>
		<result property="password" column="password"/>
		<result property="userName" column="name"/>
		<result property="email" column="email"/>
		<association property="roles" column="role_id" resultMap="resultRoles" />
	</resultMap>
	
	<resultMap type="pji.cbt.entities.Roles" id="resultRoles">
		<id property="roleId" column="id"/>
		<result property="roleName" column="name"/>
		<result property="description" column="description"/>
	</resultMap>
	
	<resultMap type="pji.cbt.entities.TestUser" id="resultTestUser">
		<id property="testId" column="id"/>
		<result property="started" column="started"/>
		<result property="ended" column="ended"/>
		<result property="score" column="score"/>
		<association property="users"  resultMap="resultUser" />
		<association property="categories"  resultMap="resultCategory" />
	</resultMap>
	
	<resultMap type="pji.cbt.entities.Category" id="resultCategory">
		<id property="idCategory" column="id"/>
		<result property="questionCategory" column="question_category"/>
		<result property="description" column="description"/>
	</resultMap>
		
	<select id="findTestByUserId" resultMap="resultTestUser">
		SELECT t.id, t.user_id, t.category_id, t.started, t.ended, t.score, c.question_category, c.description, u.name, u.username, u.email
		FROM tb_user_test t, tb_user u, tb_question_category c 
		WHERE t.category_id = c.id and t.user_id = u.id and user_id = #{user.userId}
	</select>

	<select id="saveTest" resultMap="resultTestUser">
		INSERT INTO tb_user_test(user_id,category_id,started,ended,score) VALUES(#{users.userId},#{categories.idCategory}, #{started}, #{ended}, #{score})
	</select>
	
</mapper>