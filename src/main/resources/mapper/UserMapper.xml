<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pji.cbt.mapper.UserMapper">
	<resultMap type="pji.cbt.entities.User" id="resultUser">
		<id property="id" column="id_user"/>
		<result property="username" column="username"/>
		<result property="password" column="password"/>
		<result property="name" column="name_user"/>
		<result property="email" column="email"/>
		<association property="roles" resultMap="resultRoles" />
	</resultMap>
	
	<resultMap type="pji.cbt.entities.Roles" id="resultRoles">
		<id property="id" column="id_role"/>
		<result property="name" column="name_role"/>
		<result property="description" column="description"/>
	</resultMap>
	
	<select id="findAllUser" resultMap="resultUser">
		SELECT u.id AS id_user, u.username, u.password, u.name AS name_user, u.email, u.role_id, r.id AS id_role, r.name AS name_role, r.description FROM tb_user u JOIN tb_role r ON u.role_id=r.id WHERE u.role_id = #{role_id}
	</select>
	
	<select id="findRoleById" resultMap="resultRoles">
		SELECT r.id AS id_role, r.name AS name_role, r.description FROM tb_role r WHERE r.id = #{role_id}
	</select>
	
	<select id="findOneUser" resultMap="resultUser">
		SELECT u.id AS id_user, u.username, u.password, u.name AS name_user, u.email, u.role_id FROM tb_user u WHERE username = #{username}
	</select>
	
	<select id="findOne" resultMap="resultUser">
		SELECT u.id AS id_user, u.username, u.password, u.name AS name_user, u.email, u.role_id FROM tb_user u WHERE id= #{id}
	</select>
	
	<select id="deleteOne" resultMap="resultUser">
		DELETE FROM tb_user WHERE id = #{id}
	</select>

	<select id="createUser" resultMap="resultUser">
		INSERT INTO tb_user(role_id,username,password,name,email) VALUES(#{role_id},#{username}, #{password}, #{name}, #{email})
	</select>
	
</mapper>